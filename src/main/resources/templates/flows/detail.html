<!doctype html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title>フロー詳細</title>
</head>
<body>

<h1 th:text="${flow.title}">フロー名</h1>

<p>会議時間: <b><span th:text="${flow.durationMinutes}">60</span></b> 分</p>
<p>ステータス: <b><span th:text="${flow.status}">IN_PROGRESS</span></b></p>
<p>現在ステップ: <b><span th:text="${flow.currentStepOrder}">1</span></b></p>

<hr/>

<h2>ステップ一覧</h2>
<table border="1" cellpadding="6">
  <tr>
    <th>順番</th>
    <th>参加者</th>
    <th>状態</th>
    <th>確定開始</th>
    <th>確定終了</th>
  </tr>
  <tr th:each="step : ${steps}">
    <td th:text="${step.stepOrder}">1</td>
    <td th:text="${step.participantName}">Aさん</td>
    <td th:text="${step.status}">ACTIVE</td>
    <td th:text="${step.confirmedStartAt}">-</td>
    <td th:text="${step.confirmedEndAt}">-</td>
  </tr>
</table>

<hr/>

<h2>現在の調整相手（ACTIVE）</h2>
<div th:if="${activeStep != null}">
  <p>
    <b th:text="${activeStep.participantName}">Aさん</b>
    （状態: <span th:text="${activeStep.status}">ACTIVE</span>）
  </p>

  <h3>候補日時</h3>

  <div th:if="${#lists.isEmpty(candidates)}">
    <p>候補はまだありません。</p>
  </div>

  <table th:if="${!#lists.isEmpty(candidates)}" border="1" cellpadding="6">
  <tr>
    <th>開始</th>
    <th>終了</th>
    <th>状態</th>
  </tr>
  <tr th:each="c : ${candidates}">
    <td th:text="${c.startAt}">2026-02-15T10:00</td>
    <td th:text="${c.endAt}">2026-02-15T11:00</td>
    <td th:text="${c.status}">PROPOSED</td>
  </tr>
  </table>

  <h3>候補を追加</h3>
  <form method="post" th:action="@{'/flows/' + ${flow.id} + '/candidates'}">
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

    <label>
      開始日時：
      <input type="datetime-local" name="startAt" required />
    </label>

    <button type="submit">追加</button>
  </form>
</div>

<div th:if="${activeStep == null}">
  <p>現在ACTIVEなステップがありません。フローが完了済みか、状態不整合の可能性があります。</p>
</div>

<hr/>

<p>
  <a th:href="@{/flows}">一覧へ戻る</a>
</p>

</body>
</html>
